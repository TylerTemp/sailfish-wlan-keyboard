<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, minimum-scale=1.0">
        <title>Sailfish Wlan Keyboard</title>
        <link inline="" rel="stylesheet" type="text/css" href="style/normalize.css/normalize.css" ></link>
       
        <link inline="" rel="stylesheet" type="text/css" href="style/style.css" ></link>
        <script inline="" type="text/javascript" src="js/lib/ws_events_dispatcher.js"></script>
    </head>
    <body>  
      <div class="container">
          <div class="header">
            <div class="header__title">
              sailfish-wlan-keyboard
            </div>
          </div>
          <div class="message">
            <input id="message_input" class="message__input" placeholder="Enter your text" autofocus>
        </div>
        <div class="configuration">
          <div class="configuration__item">
            Status:
             <span id="status">
              not connected
             </span>
          </div>
        </div>
      </div>
      
      <script type="text/javascript">
        var wsEndpoint = '__WS_ENDPOINT__';
        var debugCheck = '__WS_' + 'ENDPOINT__';
        
        if (wsEndpoint == debugCheck) {
          wsEndpoint = 'ws://localhost:7777';
        }
        
        var socket = new WebSocketWrapper(wsEndpoint);
        
        var message_input = document.getElementById('message_input');
        message_input.addEventListener('keyup', function(event) {
          var msg = {
            'keycode' : event.keyCode,
            'keyvalue': String.fromCharCode(event.keyCode)
          };
          
          socket.send('new_keycode', msg);
          
          if (event.keyCode == 13) {
             socket.send('new_keyrow', message_input.value); 
             message_input.value = '';
          }
        });
        
       updateReadyState();
        
        function updateReadyState() {
          setTimeout(function() {
            var status = document.getElementById('status');
            
            var readyStateMsg = [[0, 'connecting'],
                                 [1, 'connected'],
                                 [2, 'disconnecting'],
                                 [3, 'not connected']];
                                 
            status.innerHTML = readyStateMsg[socket.getSocket().readyState][1]; 
            updateReadyState();  
        }, 1000);
        }
        
      </script>
    </body>
</html>